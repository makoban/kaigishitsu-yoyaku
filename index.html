<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今日の会議室スケジュール</title>
    <style>
        /* 全体の基本設定 */
        body {
            font-family: 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* 画面いっぱいに表示 */
            /* フォントサイズはJSで設定される */
        }
        /* タイトル */
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        /* スケジュール表示エリア */
        #schedule-container {
            flex-grow: 1; /* 残りのスペースを埋める */
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 800px;
            margin: 0 auto; /* 中央寄せ */
            box-sizing: border-box; /* パディングを含めてサイズ計算 */
        }
        /* 各スケジュール項目 */
        .schedule-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 0;
            display: flex;
            align-items: center;
        }
        .schedule-item:last-child {
            border-bottom: none; /* 最後の項目は下線なし */
        }
        /* 時刻表示 */
        .time {
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
            width: 120px; /* 時間表示の幅を固定 */
            flex-shrink: 0; /* 縮小しない */
        }
        /* イベント詳細 */
        .event-details {
            flex-grow: 1; /* 残りのスペースを埋める */
            margin-left: 20px;
            display: flex; /* タイトルとボタンを並べるため */
            justify-content: space-between; /* タイトルとボタンを左右に配置 */
            align-items: center; /* 垂直方向中央揃え */
        }
        .event-details h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.4em;
        }
        .event-details p {
            margin: 0;
            color: #666;
            font-size: 0.95em;
        }
        /* 予定がない場合のメッセージ */
        .no-events {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
            font-size: 1.2em;
        }
        /* ステータスメッセージエリア */
        #status-message {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.8em;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            display: none; /* 初期は非表示 */
            max-width: 800px;
            margin: 20px auto;
        }
        /* ステータスメッセージのデフォルト色 */
        #status-message.status-default {
            background-color: #e3f2fd; /* 青系 */
            color: #1565c0; /* 濃い青 */
        }
        #status-message.status-occupied {
            background-color: #fff3e0; /* オレンジ系 */
            color: #e65100; /* 濃いオレンジ */
        }
        #status-message.status-pre-announce {
            background-color: #e8f5e9; /* 緑系 */
            color: #2e7d32; /* 濃い緑 */
        }

        /* 現在時刻表示 */
        #current-time {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 1.1em;
        }
        /* アクションボタンエリア */
        #action-buttons {
            text-align: center;
            margin-top: 20px;
            max-width: 800px;
            margin: 20px auto;
        }
        #action-buttons button {
            padding: 15px 30px;
            font-size: 1.2em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }
        #action-buttons button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        /* 削除ボタンのスタイル */
        .delete-event-btn {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            margin-left: 10px; /* タイトルとの間隔 */
        }

        /* テーマ別のスタイル調整 */
        /* 会議室テーマ (デフォルト) */
        body.theme-meeting-room #status-message.status-default { background-color: #e3f2fd; color: #1565c0; }
        body.theme-meeting-room #status-message.status-occupied { background-color: #fff3e0; color: #e65100; }
        body.theme-meeting-room #status-message.status-pre-announce { background-color: #e8f5e9; color: #2e7d32; }

        /* 受付テーマ */
        body.theme-reception #status-message.status-default { background-color: #fce4ec; color: #ad1457; } /* ピンク系 */
        body.theme-reception #status-message.status-occupied { background-color: #ffe0b2; color: #ef6c00; } /* オレンジ系 */
        body.theme-reception #status-message.status-pre-announce { background-color: #e0f2f7; color: #0277bd; } /* 水色系 */
        body.theme-reception h1 { color: #ad1457; }
        body.theme-reception .time { color: #ad1457; }

        /* フリースペーステーマ */
        body.theme-free-space #status-message.status-default { background-color: #e0f7fa; color: #00838f; } /* シアン系 */
        body.theme-free-space #status-message.status-occupied { background-color: #f1f8e9; color: #558b2f; } /* ライトグリーン系 */
        body.theme-free-space #status-message.status-pre-announce { background-color: #ede7f6; color: #5e35b1; } /* 紫系 */
        body.theme-free-space h1 { color: #00838f; }
        body.theme-free-space .time { color: #00838f; }

        /* 設定ボタン */
        #settings-button {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: #607d8b; /* グレー */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            z-index: 1000; /* 他の要素の上に表示 */
        }
        #service-settings-button {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #8bc34a; /* ライトグリーン */
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <button id="settings-button">店舗設定</button>
    <button id="service-settings-button">事業者設定</button>

    <h1 id="main-title">今日の会議室スケジュール</h1>
    <div id="status-message"></div>
    <div id="action-buttons">
        <button id="book-now-30min">今から30分予約</button>
    </div>
    <div id="schedule-container">
        <p class="no-events">スケジュールを読み込み中...</p>
    </div>
    <div id="current-time"></div>

    <script>
        // ★★★ サービス事業者設定をローカルストレージから読み込む ★★★
        const serviceSettings = JSON.parse(localStorage.getItem('meetingRoomServiceSettings')) || {};
        const API_KEY = serviceSettings.apiKey || ''; // APIキーはサービス事業者設定から取得

        // ★★★ 店舗設定をローカルストレージから読み込む ★★★
        const savedSettings = JSON.parse(localStorage.getItem('meetingRoomSettings')) || {};
        const CLIENT_ID = savedSettings.clientId || ''; // CLIENT_IDは店舗設定から取得

        const CALENDAR_ID = savedSettings.calendarId || 'your-calendar-id@group.calendar.google.com'; // デフォルト値
        const CALENDAR_DISPLAY_NAME = savedSettings.calendarDisplayName || '会議室'; // デフォルト値
        const REFRESH_INTERVAL_MS = (parseInt(savedSettings.refreshInterval) || 60) * 1000; // デフォルト60秒
        const DISPLAY_THEME = savedSettings.displayTheme || 'meeting-room'; // デフォルトテーマ
        const PRE_ANNOUNCE_MINUTES = parseInt(savedSettings.preAnounceMinutes) || 15; // デフォルト15分前
        const PRE_ANNOUNCE_PAIRS = savedSettings.preAnouncePairs || []; // デフォルト空配列
        const CURRENT_ANNOUNCE_PAIRS = savedSettings.currentAnouncePairs || []; // デフォルト空配列
        const FONT_SIZE_PX = parseInt(savedSettings.fontSize) || 16; // デフォルト16px


        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events'; // イベントの読み書き権限

        const SCHEDULE_CONTAINER = document.getElementById('schedule-container');
        const STATUS_MESSAGE_ELEMENT = document.getElementById('status-message');
        const CURRENT_TIME_ELEMENT = document.getElementById('current-time');
        const BOOK_NOW_30MIN_BUTTON = document.getElementById('book-now-30min');
        const MAIN_TITLE_ELEMENT = document.getElementById('main-title');
        const SETTINGS_BUTTON = document.getElementById('settings-button');
        const SERVICE_SETTINGS_BUTTON = document.getElementById('service-settings-button'); // 新しいボタン

        let gisInited = false;
        let gapiInited = false;
        let tokenClient;
        let previousEventsDataString = null;
        let previousStatusMessageData = { message: '', statusClass: '' }; // statusClassを追加

        // Google APIクライアントライブラリの初期化
        function gapiLoaded() {
            // APIキーとCLIENT_IDが設定されているかチェック
            if (!API_KEY || !CLIENT_ID) {
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">設定が不足しています。<br>「事業者設定」ボタンと「店舗設定」ボタンから必須項目を設定してください。</p>';
                STATUS_MESSAGE_ELEMENT.style.display = 'none';
                BOOK_NOW_30MIN_BUTTON.disabled = true;
                return; // 以降の処理を中断
            }
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY, // スケジュール表示用（読み取り）のAPIキー
                discoveryDocs: DISCOVERY_DOCS,
            });
            gapiInited = true;
            maybeEnableButtons();
        }

        // Google Identity Services (GIS) クライアントの初期化
        function gisLoaded() {
            // APIキーとCLIENT_IDが設定されているかチェック
            if (!API_KEY || !CLIENT_ID) {
                // gapiLoadedで既にメッセージが出ているのでここでは何もしない
                return; // 処理を中断
            }
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // 認証完了後に別途ハンドリング
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gisInited && gapiInited) {
                BOOK_NOW_30MIN_BUTTON.disabled = false;
            }
        }

        // 認証と予約処理
        async function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error) {
                    console.error('Authentication Error:', resp.error);
                    alert('Googleアカウント認証に失敗しました。');
                    return;
                }
                await bookMeeting(30); // 認証成功後に予約実行
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                await bookMeeting(30);
            }
        }

        // Google Calendar APIから予定を取得し、表示を更新する関数
        async function fetchCalendarEvents() {
            // APIキーまたはCLIENT_IDが設定されていない場合は処理をスキップ
            if (!API_KEY || !CLIENT_ID) {
                 SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">設定が不足しています。<br>「事業者設定」ボタンと「店舗設定」ボタンから必須項目を設定してください。</p>';
                 STATUS_MESSAGE_ELEMENT.style.display = 'none';
                 BOOK_NOW_30MIN_BUTTON.disabled = true;
                 return;
            }

            // カレンダーIDが設定されていない場合は処理をスキップ
            if (!CALENDAR_ID || CALENDAR_ID === 'your-calendar-id@group.calendar.google.com') {
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">店舗設定でGoogleカレンダーIDが不足しています。<br>左上の「店舗設定」ボタンから設定してください。</p>';
                STATUS_MESSAGE_ELEMENT.style.display = 'none';
                BOOK_NOW_30MIN_BUTTON.disabled = true; // ボタンも無効化
                return;
            }

            const now = new Date(); // 現在の日時
            const startOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
            const endOfToday = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);

            const url = `https://www.googleapis.com/calendar/v3/calendars/${CALENDAR_ID}/events?key=${API_KEY}&timeMin=${startOfToday.toISOString()}&timeMax=${endOfToday.toISOString()}&singleEvents=true&orderBy=startTime`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                const currentEventsDataString = JSON.stringify(data.items);
                if (currentEventsDataString !== previousEventsDataString) {
                    updateScheduleDisplay(data.items);
                    previousEventsDataString = currentEventsDataString;
                    console.log('スケジュール表示を更新しました。');
                } else {
                    console.log('スケジュールデータに変化なし。表示は更新しません。');
                }

                const newStatusMessageData = getStatusMessageData(data.items);
                if (JSON.stringify(newStatusMessageData) !== JSON.stringify(previousStatusMessageData)) {
                    updateStatusMessageDisplay(newStatusMessageData);
                    previousStatusMessageData = newStatusMessageData;
                    console.log('ステータスメッセージを更新しました。');
                } else {
                    console.log('ステータスメッセージに変化なし。表示は更新しません。');
                }

            } catch (error) {
                console.error('Error fetching calendar events:', error);
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">スケジュールの読み込みに失敗しました。</p>';
                STATUS_MESSAGE_ELEMENT.style.display = 'none';
            }
        }

        // 取得した予定をHTMLに表示する関数
        function updateScheduleDisplay(events) {
            SCHEDULE_CONTAINER.innerHTML = '';

            if (events && events.length > 0) {
                events.forEach(event => {
                    const start = event.start.dateTime || event.start.date;
                    const end = event.end.dateTime || event.end.date;
                    const eventTitle = event.summary || 'タイトルなし';

                    const startDate = new Date(start);
                    const endDate = new Date(end);

                    let timeDisplay;
                    if (event.start.date && !event.start.dateTime) {
                        timeDisplay = '終日';
                    } else {
                        const startTime = startDate.toLocaleTimeString('ja-JP', {hour: '2-digit', minute:'2-digit'});
                        const endTime = endDate.toLocaleTimeString('ja-JP', {hour: '2-digit', minute:'2-digit'});
                        timeDisplay = `${startTime} - ${endTime}`;
                    }

                    const itemDiv = document.createElement('div');
                    itemDiv.classList.add('schedule-item');
                    itemDiv.innerHTML = `
                        <div class="time">${timeDisplay}</div>
                        <div class="event-details">
                            <h3>${eventTitle}</h3>
                            <button class="delete-event-btn" data-event-id="${event.id}" style="background-color: #f44336; color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; margin-left: 10px;">削除</button>
                        </div>
                    `;
                    SCHEDULE_CONTAINER.appendChild(itemDiv);
                });

                document.querySelectorAll('.delete-event-btn').forEach(button => {
                    button.addEventListener('click', async (e) => {
                        const eventId = e.target.dataset.eventId;
                        if (confirm('この予約を削除してもよろしいですか？')) {
                            await deleteMeeting(eventId);
                        }
                    });
                });

            } else {
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">今日の予定はありません。</p>';
            }
        }

        // ウェルカムメッセージや空室状況の「データ」を生成する関数 (DOM更新は行わない)
        function getStatusMessageData(events) {
            const now = new Date();
            let currentEvent = null;
            let nextEvent = null;

            if (events && events.length > 0) {
                for (let i = 0; i < events.length; i++) {
                    const event = events[i];
                    const start = new Date(event.start.dateTime || event.start.date);
                    const end = new Date(event.end.dateTime || event.end.date);
                    if (now >= start && now < end) {
                        currentEvent = event;
                    } else if (now < start) {
                        if (!nextEvent || start < new Date(nextEvent.start.dateTime || nextEvent.start.date)) {
                            nextEvent = event;
                        }
                    }
                }
            }

            let message = '';
            let statusClass = 'status-default'; // デフォルトのクラス

            if (currentEvent) {
                // 当時間の案内名設定を適用
                let displaySummary = currentEvent.summary || '会議中';
                // 設定された「カレンダー項目名キーワード」にマッチするものを探す
                const matchedCurrentAnounce = CURRENT_ANNOUNCE_PAIRS.find(pair => currentEvent.summary && currentEvent.summary.includes(pair.key));
                
                if (matchedCurrentAnounce) {
                    // キーワードを件名から削除し、残った部分（例: 氏名）を抽出
                    const remainingPart = currentEvent.summary.replace(matchedCurrentAnounce.key, '').trim();
                    // 抽出した部分と設定された「表示したい後続の文字列」を結合
                    displaySummary = `${remainingPart}${matchedCurrentAnounce.value}`;
                }
                
                message = `<img src="https://img.icons8.com/ios-filled/50/2e7d32/meeting-room.png" alt="meeting icon" style="vertical-align: middle; margin-right: 10px;">${displaySummary}、ご利用中です`;
                statusClass = 'status-occupied';
            } else if (nextEvent) {
                const nextStartTime = new Date(nextEvent.start.dateTime || nextEvent.start.date);
                const diffMinutes = Math.floor((nextStartTime - now) / (1000 * 60));
                
                if (diffMinutes <= PRE_ANNOUNCE_MINUTES && diffMinutes >= 0) {
                    // 予約があった場合の案内名設定を適用
                    let displaySummary = nextEvent.summary || 'ご予約';
                    // 設定された「カレンダー項目名キーワード」にマッチするものを探す
                    const matchedPreAnounce = PRE_ANNOUNCE_PAIRS.find(pair => nextEvent.summary && nextEvent.summary.includes(pair.key));

                    if (matchedPreAnounce) {
                        // キーワードを件名から削除し、残った部分（例: 氏名）を抽出
                        const remainingPart = nextEvent.summary.replace(matchedPreAnounce.key, '').trim();
                        // 抽出した部分と設定された「表示したい後続の文字列」を結合
                        displaySummary = `${remainingPart}${matchedPreAnounce.value}`;
                    }

                    message = `<img src="https://img.icons8.com/ios-filled/50/2e7d32/handshake.png" alt="welcome icon" style="vertical-align: middle; margin-right: 10px;">${displaySummary}！`;
                    statusClass = 'status-pre-announce';
                } else {
                    message = `<img src="https://img.icons8.com/ios-filled/50/7f8c8d/clock.png" alt="empty icon" style="vertical-align: middle; margin-right: 10px;">会議室は現在空室です`;
                    statusClass = 'status-default';
                }
            } else {
                message = `<img src="https://img.icons8.com/ios-filled/50/7f8c8d/clock.png" alt="empty icon" style="vertical-align: middle; margin-right: 10px;">会議室は現在空室です`;
                statusClass = 'status-default';
            }
            return { message: message, statusClass: statusClass };
        }

        // ステータスメッセージを実際にDOMに反映する関数
        function updateStatusMessageDisplay(statusData) {
            STATUS_MESSAGE_ELEMENT.innerHTML = statusData.message;
            STATUS_MESSAGE_ELEMENT.className = ''; // クラスをリセット
            STATUS_MESSAGE_ELEMENT.classList.add(statusData.statusClass); // 新しいクラスを追加
            STATUS_MESSAGE_ELEMENT.style.display = 'block';
        }

        // 現在時刻を更新する関数
        function updateCurrentTime() {
            const now = new Date();
            CURRENT_TIME_ELEMENT.textContent = now.toLocaleString('ja-JP', {
                year: 'numeric', month: 'long', day: 'numeric', weekday: 'short',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }

        // 会議を予約する関数
        async function bookMeeting(durationMinutes) {
            const now = new Date();
            const endTime = new Date(now.getTime() + durationMinutes * 60 * 1000);

            const event = {
                'summary': '臨時会議（今すぐ予約）', // 予約時のデフォルト件名
                'description': '会議室サイネージからの自動予約',
                'start': {
                    'dateTime': now.toISOString(),
                    'timeZone': Intl.DateTimeFormat().resolvedOptions().timeZone,
                },
                'end': {
                    'dateTime': endTime.toISOString(),
                    'timeZone': Intl.DateTimeFormat().resolvedOptions().timeZone,
                },
                'reminders': {
                    'useDefault': false,
                    'overrides': [
                        {'method': 'email', 'minutes': 30},
                        {'method': 'popup', 'minutes': 10},
                    ],
                },
            };

            try {
                const response = await gapi.client.calendar.events.insert({
                    'calendarId': CALENDAR_ID,
                    'resource': event,
                });
                console.log('Event created: ', response.result);
                alert(`${durationMinutes}分の会議を予約しました！`);
                fetchCalendarEvents(); // 予約後、スケジュールを再読み込み
            } catch (err) {
                console.error('Error creating event: ', err);
                alert('会議の予約に失敗しました。認証エラーか、カレンダーに書き込み権限がありません。');
            }
        }

        // 会議を削除する関数
        async function deleteMeeting(eventId) {
            try {
                const response = await gapi.client.calendar.events.delete({
                    'calendarId': CALENDAR_ID,
                    'eventId': eventId,
                });
                console.log('Event deleted: ', response.result);
                alert('会議予約を削除しました。');
                fetchCalendarEvents(); // 削除後、スケジュールを再読み込み
            } catch (err) {
                console.error('Error deleting event: ', err);
                alert('会議予約の削除に失敗しました。認証エラーか、カレンダーに書き込み権限がありません。');
            }
        }

        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', () => {
            // タイトルとフォントサイズ、テーマの適用
            document.title = `${CALENDAR_DISPLAY_NAME} スケジュール`;
            MAIN_TITLE_ELEMENT.textContent = `${CALENDAR_DISPLAY_NAME} スケジュール`;
            document.body.style.fontSize = `${FONT_SIZE_PX}px`;
            document.body.classList.add(`theme-${DISPLAY_THEME}`);

            // APIキーとCLIENT_IDが設定されていない場合は警告表示
            if (!API_KEY || !CLIENT_ID) {
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">設定が不足しています。<br>「事業者設定」ボタンと「店舗設定」ボタンから必須項目を設定してください。</p>';
                STATUS_MESSAGE_ELEMENT.style.display = 'none';
                BOOK_NOW_30MIN_BUTTON.disabled = true;
                return; // 以降のAPI関連処理を中断
            }
            // カレンダーIDが設定されていない場合は警告表示
            if (!CALENDAR_ID || CALENDAR_ID === 'your-calendar-id@group.calendar.google.com') {
                SCHEDULE_CONTAINER.innerHTML = '<p class="no-events">店舗設定でGoogleカレンダーIDが不足しています。<br>左上の「店舗設定」ボタンから設定してください。</p>';
                STATUS_MESSAGE_ELEMENT.style.display = 'none';
                BOOK_NOW_30MIN_BUTTON.disabled = true;
                return; // 以降のAPI関連処理を中断
            }

            fetchCalendarEvents();
            updateCurrentTime();
            BOOK_NOW_30MIN_BUTTON.addEventListener('click', handleAuthClick);
            BOOK_NOW_30MIN_BUTTON.disabled = true; // 初期状態では無効

            // 設定ボタンのイベントリスナー
            SETTINGS_BUTTON.addEventListener('click', () => {
                window.location.href = 'settings.html'; // 店舗設定画面へ遷移
            });
            // 事業者設定ボタンのイベントリスナー
            SERVICE_SETTINGS_BUTTON.addEventListener('click', () => {
                window.location.href = 'settings_2.html'; // 事業者設定画面へ遷移
            });
        });

        // 定期更新
        setInterval(() => {
            fetchCalendarEvents();
            updateCurrentTime();
        }, REFRESH_INTERVAL_MS);
    </script>

    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

</body>
</html>
